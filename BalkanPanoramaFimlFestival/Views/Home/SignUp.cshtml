@model SignUpViewModel

@{
    ViewData["Title"] = "SignUp";
}

@* Codes inside of this body, will be injected into RenderSectionAsync inside of _Layout.cshtml
Writing the script codes here makes it possible to run the scripts after initiating libraries like Jquery, Bootstrap vs.
If scripts are put inside any other place on the cshtml, other than section Scripts here;
They will be executed on the RenderBody on _Layout, which means for example if you want to run a script related to JQuery,
this way you would be running the script without adding the Jquery library first, which causes the issue.
So basically adding the scripts other than here will cause the scripts not working properly.
*@
@section Scripts
{
    @* Makes it possible to run the scripts inside of _ValidationScriptsPartial, so libraries can be installed related to those scripts. *@
    @* With adding this script here, validation on Registration form is being done on the client side anymore, 
     without sending a request to the server.*@
    @await Html.PartialAsync("PartialScripts/_ValidationScriptsPartial")
    @await Html.PartialAsync("PartialScripts/_ShowPasswordScriptsPartial")
}

<div class="row">
    <div class="col-md-6 offset-md-3">
        <h2>SIGN UP</h2>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-info" role="alert">
                @TempData["SuccessMessage"]
            </div>
        }

        @* General errors related to application(comes from ModelState) *@
        <div asp-validation-summary=ModelOnly class="alert alert-danger" role="alert">
        </div>

        <form asp-asp-controller="Home" asp-action="SignUp" method="post">
            <div class="row mb-3">
                <label for="FirstName" class="col-md-4 col-form-label" asp-for="FirstName"></label>
                <div class="col-md-8">
                    <input asp-for="FirstName" class="form-control">
                    <span class="text-danger" asp-validation-for="FirstName"></span>
                </div>
            </div>
            <div class="row mb-3">
                <label for="LastName" class="col-md-4 col-form-label" asp-for="LastName"></label>
                <div class="col-md-8">
                    <input asp-for="LastName" class="form-control">
                    <span class="text-danger" asp-validation-for="LastName"></span>
                </div>
            </div>
            <div class="row mb-3">
                <label for="Email" class="col-md-4 col-form-label" asp-for="Email"></label>
                <div class="col-md-8">
                    <input asp-for="Email" class="form-control">
                    <span class="text-danger" asp-validation-for="Email"></span>
                </div>
            </div>
            <div class="row mb-3">
                <label for="PhoneNumber" class="col-md-4 col-form-label" asp-for="PhoneNumber"></label>
                <div class="col-md-8">
                    <div class="input-group">
                        @* id attribute makes it possible to run phone scripts *@
                        @* type="tel" attribute makes it possible to enter only numbers *@
                        <input id="phone" type="tel" asp-for="PhoneNumber" class="form-control"> 
                    </div>
                    <span class="text-danger" asp-validation-for="PhoneNumber"></span>
                </div>
            </div>
            <div class="row mb-3">
                <label for="Country" class="col-md-4 col-form-label" asp-for="Country"></label>
                <div class="col-md-8">
                    <select id="CountrySelect" name="Country" class="form-control">
                        <option value="">Select Country</option>
                        <!-- Options will be dynamically populated -->
                        <option value="OTHER">Other</option>
                    </select>
                    <input type="text" id="OtherCountry" name="OtherCountry" class="form-control mt-2" placeholder="Please specify" style="display: none;">
                    <span id="CountryError" class="text-danger" style="display: none;">Please specify the country.</span>
                </div>
            </div>
            <div class="row mb-3">
                <label for="Password" class="col-md-4 col-form-label" asp-for="Password"></label>
                <div class="col-md-8">
                    <div class="input-group">
                        <input asp-for="Password" class="form-control">
                        <button type="button" id="togglePassword" class="btn btn-outline-secondary">
                            <i class="fas fa-eye"></i> <!-- Eye icon -->
                        </button>
                    </div>
                    <span class="text-danger" asp-validation-for="Password"></span>
                </div>
            </div>
            <div class="row mb-3">
                <label for="ConfirmPassword" class="col-md-4 col-form-label" asp-for="ConfirmPassword"></label>
                <div class="col-md-8">
                    <div class="input-group">
                        <input asp-for="ConfirmPassword" class="form-control">
                        <button type="button" id="togglePassword" class="btn btn-outline-secondary">
                            <i class="fas fa-eye"></i> <!-- Eye icon -->
                        </button>
                    </div>
                    <span class="text-danger" asp-validation-for="ConfirmPassword"></span>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-8 offset-md-4">
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </div>
            </div>

        </form>
    </div>
</div>


@* Phone Number Script *@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var input = document.querySelector("#phone");
        window.intlTelInput(input, {
            initialCountry: "tr", // Set your default country here
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js" // for formatting
        });
    });
</script>

@* Country Selector Script *@
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var countrySelect = document.getElementById('CountrySelect');
        var otherCountryInput = document.getElementById('OtherCountry');
        var countryError = document.getElementById('CountryError');
        var form = document.querySelector('form');

        // Fetch the list of countries from an external API
        fetch('https://restcountries.com/v3.1/all')
            .then(response => response.json())
            .then(data => {
                // Populate the select element with options
                data.forEach(country => {
                    if (country.name && country.cca2) {
                        var option = document.createElement('option');
                        option.value = country.cca2;
                        option.textContent = country.name.common;
                        countrySelect.appendChild(option);
                    }
                });
            })
            .catch(error => {
                console.error('Error fetching countries:', error);
            });

        // Toggle visibility of the custom country input based on the selected option
        countrySelect.addEventListener('change', function () {
            if (this.value === 'OTHER') {
                otherCountryInput.style.display = 'block';
                otherCountryInput.focus();
            } else {
                otherCountryInput.style.display = 'none';
                otherCountryInput.value = ''; // Clear the custom country input
            }
        });

        // Validate the form on submit
        form.addEventListener('submit', function (event) {
            if (countrySelect.value === 'OTHER' && otherCountryInput.value.trim() === '') {
                countryError.style.display = 'block';
                event.preventDefault(); // Prevent form submission
            } else {
                countryError.style.display = 'none';
            }
        });
    });
</script>